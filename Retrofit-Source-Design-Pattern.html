<!DOCTYPE html>
<html lang="zh">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
<title>透过Retrofit使用看其源码设计模式 - 老胡</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



    <meta name="description" content="前言这篇文章我将从Retrofit的基本用法出发，透过其使用步骤，一步步的探究Retrofit的实现原理及其源码的设计模式。这篇文章可能会将Retrofit中用到的设计模式和其实现原理穿插着写，所以各位同学也可以选择性的阅读。而对于Retrofit具体使用还不太清楚的同学可以去看的另一篇文章Retrofit2的使用介绍">
<meta name="keywords" content="Android,Retrofit">
<meta property="og:type" content="article">
<meta property="og:title" content="透过Retrofit使用看其源码设计模式">
<meta property="og:url" content="http://ittiger.cn/Retrofit-Source-Design-Pattern.html">
<meta property="og:site_name" content="老胡">
<meta property="og:description" content="前言这篇文章我将从Retrofit的基本用法出发，透过其使用步骤，一步步的探究Retrofit的实现原理及其源码的设计模式。这篇文章可能会将Retrofit中用到的设计模式和其实现原理穿插着写，所以各位同学也可以选择性的阅读。而对于Retrofit具体使用还不太清楚的同学可以去看的另一篇文章Retrofit2的使用介绍">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://ittiger.cn/images/og_image.png">
<meta property="og:updated_time" content="2019-05-09T01:56:40.906Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="透过Retrofit使用看其源码设计模式">
<meta name="twitter:description" content="前言这篇文章我将从Retrofit的基本用法出发，透过其使用步骤，一步步的探究Retrofit的实现原理及其源码的设计模式。这篇文章可能会将Retrofit中用到的设计模式和其实现原理穿插着写，所以各位同学也可以选择性的阅读。而对于Retrofit具体使用还不太清楚的同学可以去看的另一篇文章Retrofit2的使用介绍">
<meta name="twitter:image" content="http://ittiger.cn/images/og_image.png">







<link rel="icon" href="/images/football.svg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/darcula.css">


    
    
    
    <style>body>.footer,body>.navbar,body>.section{opacity:0}</style>
    

    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    

    
    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">


    
    
    
    

<link rel="stylesheet" href="/css/back-to-top.css">


    
    

    
    
<script>
var _hmt = _hmt || [];
(function() {
    var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?5e886c0a11c8dce0abbe888faadd1000";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
})();
</script>

    
    

    
    
<link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

    
    
    

    
    
    
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    

    


<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/football.svg" alt="透过Retrofit使用看其源码设计模式" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item" href="/">主页</a>
                
                <a class="navbar-item" href="/archives">归档</a>
                
                <a class="navbar-item" href="/categories">分类</a>
                
                <a class="navbar-item" href="/tags">标签</a>
                
                <a class="navbar-item" href="/about">关于</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    
                    <a class="navbar-item" target="_blank" title="Download on GitHub" href="https://github.com/huyongli">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                
                
                
                <a class="navbar-item search" title="搜索" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main"><div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2016-10-13T08:43:42.000Z">2016-10-13</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Android/">Android</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    43 分钟 读完 (大约 6495 个字)
                </span>
                
                
                <span class="level-item has-text-grey" id="busuanzi_container_page_pv">
                    <i class="far fa-eye"></i>
                    <span id="busuanzi_value_page_pv">0</span>次访问
                </span>
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                透过Retrofit使用看其源码设计模式
            
        </h1>
        <div class="content">
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>这篇文章我将从Retrofit的基本用法出发，透过其使用步骤，一步步的探究Retrofit的实现原理及其源码的设计模式。这篇文章可能会将Retrofit中用到的设计模式和其实现原理穿插着写，所以各位同学也可以选择性的阅读。而对于Retrofit具体使用还不太清楚的同学可以去看的另一篇文章<a href="http://ittiger.cn/2016/08/29/Retrofit2%E4%BD%BF%E7%94%A8%E4%BB%8B%E7%BB%8D/">Retrofit2的使用介绍</a></p>
<a id="more"></a>
<h2 id="Retrofit基本用法"><a href="#Retrofit基本用法" class="headerlink" title="Retrofit基本用法"></a>Retrofit基本用法</h2><p>我以用户登录作为示例：</p>
<h3 id="声明接口"><a href="#声明接口" class="headerlink" title="声明接口"></a>声明接口</h3><p>首先我们先定义一个登录服务接口<code>LoginService</code>，如下：<br><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">LoginService</span> </span>&#123;</span><br><span class="line">    <span class="hljs-meta">@FormUrlEncoded</span></span><br><span class="line">    <span class="hljs-meta">@POST</span>(<span class="hljs-string">"login"</span>)</span><br><span class="line">    <span class="hljs-function">Call&lt;String&gt; <span class="hljs-title">login</span><span class="hljs-params">(@Field(<span class="hljs-string">"username"</span>)</span> String name, @<span class="hljs-title">Field</span><span class="hljs-params">(<span class="hljs-string">"password"</span>)</span> String password)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="创建Retrofit对象"><a href="#创建Retrofit对象" class="headerlink" title="创建Retrofit对象"></a>创建Retrofit对象</h3><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = <span class="hljs-keyword">new</span> Retrofit.Builder()</span><br><span class="line">    .baseUrl(<span class="hljs-string">"http://ittiger.cn"</span>)</span><br><span class="line">    .addConverterFactory(GsonConverterFactory.create())</span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure>
<h3 id="发起请求"><a href="#发起请求" class="headerlink" title="发起请求"></a>发起请求</h3><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LoginService service = retrofit.create(LoginService.class);</span><br><span class="line">Call&lt;User&gt; call = service.login(<span class="hljs-string">"user"</span>, <span class="hljs-string">"pwd"</span>);</span><br><span class="line">call.execute()或call.enqueue()</span><br></pre></td></tr></table></figure>
<h2 id="Retrofit关键类"><a href="#Retrofit关键类" class="headerlink" title="Retrofit关键类"></a>Retrofit关键类</h2><p>在讲Retrofit实现原理之前，我先说下Retrofit里面涉及到几个关键类都是干什么用的</p>
<ol>
<li><code>Retorift：</code> 负责配置请求过程中的基本参数，如：请求地址，结果转换器，自定义OKHttpClient等，同时还会生成请求接口对象</li>
<li><code>Call：</code> 网络请求执行者(<code>Retrofit.Call</code>)，比如：上面示例中最后调用<code>login</code>方法得到的<code>Call</code>对象就是此接口的实例</li>
<li><code>OkHttpCall：</code> 此类是<code>Retrofit.Call</code>接口的实现，示例中最后调用<code>login</code>方法得到的<code>Call</code>对象就是此类的实例。但是其底层网络请求执行都是通过<code>OkHttp.Call</code>接口间接执行的，也就是说<code>OkHttpCall</code>是对<code>OkHttp.Call</code>网络请求功能的封装。</li>
<li><code>Converter &amp; Converter.Factory：</code> 分别负责网络请求结果转换以及生成<code>Converter</code>转换器</li>
<li><code>CallAdapter &amp; CallAdapter.Factory：</code> 分别负责对<code>Retrofit.Call实例(OkHttpCall)</code>进行适配及生成<code>CallAdapter</code>适配器</li>
<li><code>Platform：</code> 确定<code>Retrofit</code>当前运行平台，以及确定当前平台默认的的<code>CallAdapter.Factory</code>和<code>Executor</code></li>
<li><code>ExecutorCallAdapterFactory：</code> Android平台下的默认<code>CallAdapter.Factory</code>实现</li>
<li><code>ServiceMethod：</code> 解析接口服务所有注解、生成请求对象<code>Request</code>、解析请求结果<code>Response</code></li>
<li><code>ParameterHandler：</code> 服务接口方法(<code>login()</code>)参数解析处理器，配合<code>ServiceMethod</code>进行服务接口参数注解解析</li>
<li><code>RequestBuilder：</code> 根据参数和<code>URL</code>构造请求需要的<code>OkHttp.Request</code>对象</li>
</ol>
<p>以上就是Retrofit源码实现中比较关键的10个类及其相关作用</p>
<h2 id="使用流程-gt-gt-实现-gt-gt-设计模式"><a href="#使用流程-gt-gt-实现-gt-gt-设计模式" class="headerlink" title="使用流程 &gt;&gt; 实现 &gt;&gt; 设计模式"></a>使用流程 &gt;&gt; 实现 &gt;&gt; 设计模式</h2><h2 id="Builder模式创建Retrofit"><a href="#Builder模式创建Retrofit" class="headerlink" title="Builder模式创建Retrofit"></a>Builder模式创建Retrofit</h2><h3 id="Retrofit场景"><a href="#Retrofit场景" class="headerlink" title="Retrofit场景"></a>Retrofit场景</h3><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = <span class="hljs-keyword">new</span> Retrofit.Builder()</span><br><span class="line">    .baseUrl(<span class="hljs-string">"http://ittiger.cn"</span>)</span><br><span class="line">    .addConverterFactory(GsonConverterFactory.create())</span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure>
<p>上面代码的对象创建方式看着是不是似曾相识，看着很眼熟，没错，Android里面的Dialog的创建就是使用的这种方式：<code>Builder模式</code></p>
<h3 id="Builder模式定义"><a href="#Builder模式定义" class="headerlink" title="Builder模式定义"></a>Builder模式定义</h3><p>将一个复杂对象的构建与它的表示分离，使得同样的构建可以创建不同的表示</p>
<h3 id="Builder模式使用场景"><a href="#Builder模式使用场景" class="headerlink" title="Builder模式使用场景"></a>Builder模式使用场景</h3><ol>
<li>相同的方法不同的执行顺序产生不同的结果</li>
<li>多个部件都可以装配到一个对象中，但是产生的结果不同</li>
</ol>
<h3 id="Builder模式类图"><a href="#Builder模式类图" class="headerlink" title="Builder模式类图"></a>Builder模式类图</h3><p><img src="/img/design_builder.bmp" alt></p>
<h3 id="Retrofit中的Builder模式"><a href="#Retrofit中的Builder模式" class="headerlink" title="Retrofit中的Builder模式"></a>Retrofit中的Builder模式</h3><ol>
<li><code>Retrofit</code>中的<code>Builder模式</code>是简化版的<code>Builder模式</code>，省略了抽象建造者和指挥者</li>
<li>不同的配置会对<code>Retrofit</code>产生不同的影响，如果通过<code>addCallAdapterFactory()</code>配置<code>CallAdapterFactory</code>和不配置<code>CallAdapterFactory</code>会对<code>Retrofit</code>产生完全不同的影响。</li>
<li>如果<code>Retrofit</code>中使用构造方法的方式创建对象，则需要实现多个不同参数的构造方法，而使用构造方法创建对象时如果参数太多，很多时候参数代表的意思是不太理解的，总归来说就是创建过程不直观。</li>
</ol>
<h3 id="Builder模式优缺点"><a href="#Builder模式优缺点" class="headerlink" title="Builder模式优缺点"></a>Builder模式优缺点</h3><ul>
<li>优点：<ol start="2">
<li>不需要知道产品内部的组成细节，产品与创建过程解耦</li>
<li>分步组装产品，使得产品的创建过程更精细更清晰</li>
<li>容易扩展，新产品只需要新建一个建造者即可</li>
</ol>
</li>
<li>缺点：<ol>
<li>Builder模式创建的产品差异性小，使用范围受限制</li>
<li>不同的产品会产生多个建造者和指挥者</li>
</ol>
</li>
</ul>
<h2 id="Retrofit创建流程-gt-gt-Platform"><a href="#Retrofit创建流程-gt-gt-Platform" class="headerlink" title="Retrofit创建流程 &gt;&gt; Platform"></a>Retrofit创建流程 &gt;&gt; Platform</h2><p>在创建Retrofit过程中有这样一行代码：<br><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = <span class="hljs-keyword">new</span> Retrofit.Builder()</span><br><span class="line">...</span><br><span class="line">.build();</span><br></pre></td></tr></table></figure></p>
<p>从代码可以看到在创建<code>Retrofit</code>时得先根据<code>Retrofit.Builder</code>内部类的默认构造方法<code>Retrofit.Builder()</code>创建一个<code>Builder</code>对象，所以我们来看看这个默认构造方法里都做了些什么事：<br><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Builder</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">  <span class="hljs-keyword">this</span>(Platform.get());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>OK，我们再来看看我们前面说到的<code>Platform</code>这个平台类的静态方法<code>get()</code><br><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//静态实例对象，类加载就确定了</span></span><br><span class="line"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Platform PLATFORM = findPlatform();</span><br><span class="line"></span><br><span class="line">  <span class="hljs-function"><span class="hljs-keyword">static</span> Platform <span class="hljs-title">get</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> PLATFORM;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Platform <span class="hljs-title">findPlatform</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">      Class.forName(<span class="hljs-string">"android.os.Build"</span>);</span><br><span class="line">      <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT != <span class="hljs-number">0</span>) &#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Android();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException ignored) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">      Class.forName(<span class="hljs-string">"java.util.Optional"</span>);</span><br><span class="line">      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Java8();</span><br><span class="line">    &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException ignored) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">      Class.forName(<span class="hljs-string">"org.robovm.apple.foundation.NSObject"</span>);</span><br><span class="line">      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> IOS();</span><br><span class="line">    &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException ignored) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Platform();</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>通过上面的代码我们可以很明确的知道，在<code>Platform</code>类加载的时候它就通过反射的机制确定了当前运行的平台是属于哪一个，是<code>Android</code>，是<code>Java8</code>还是<code>IOS</code>，并生成对应的平台类的实例，<code>get()</code>方法是用来获取当前的平台类的实例。</p>
<p>目前，我们只关注<code>Android</code>平台下的<code>Platform</code>实例，我们也来看看<code>Android</code>平台类中做了些什么：<br><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Android</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Platform</span> </span>&#123;</span><br><span class="line">    <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">public</span> Executor <span class="hljs-title">defaultCallbackExecutor</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MainThreadExecutor();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span> CallAdapter.<span class="hljs-function">Factory <span class="hljs-title">defaultCallAdapterFactory</span><span class="hljs-params">(Executor callbackExecutor)</span> </span>&#123;</span><br><span class="line">      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ExecutorCallAdapterFactory(callbackExecutor);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainThreadExecutor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Executor</span> </span>&#123;</span><br><span class="line">      <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Handler handler = <span class="hljs-keyword">new</span> Handler(Looper.getMainLooper());</span><br><span class="line"></span><br><span class="line">      <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">execute</span><span class="hljs-params">(Runnable r)</span> </span>&#123;</span><br><span class="line">        handler.post(r);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>可以看到<code>Android</code>类中重写了<code>Platform</code>类的两个方法<code>defaultCallbackExecutor()</code>和<code>defaultCallAdapterFactory(Executor callbackExecutor)</code></p>
<ol>
<li>前者就是用来返回当前平台下默认的<code>Executor</code>，这<code>Android</code>平台下就是<code>MainThreadExecutor</code>这个类的实例，可以看到这个执行器主要就是用来进行线程切换的，因为我们知道安卓平台下所有的UI操作都必须在UI线程中执行。</li>
<li>后者就是用来返回当前平台下默认的<code>CallAdapter.Factory</code></li>
<li>当然你也可以不使用这两个默认值，都可以在创建<code>Retrofit</code>过程中自定义配置自己需要的相关实例</li>
</ol>
<h2 id="Retrofit创建流程-gt-gt-ExecutorCallAdapterFactory"><a href="#Retrofit创建流程-gt-gt-ExecutorCallAdapterFactory" class="headerlink" title="Retrofit创建流程 &gt;&gt; ExecutorCallAdapterFactory"></a>Retrofit创建流程 &gt;&gt; ExecutorCallAdapterFactory</h2><p>看完<code>Platform</code>之后紧接着我们再来看看<code>Android</code>平台下默认的<code>CallAdapter.Factory</code>实现<code>ExecutorCallAdapterFactory</code>都做了些什么，这里只贴关键代码：<br><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CallAdapter</span>&lt;<span class="hljs-title">T</span>&gt; </span>&#123;</span><br><span class="line">	<span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Factory</span> </span>&#123;</span><br><span class="line">	    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> CallAdapter&lt;?&gt; get(Type returnType, Annotation[] annotations,</span><br><span class="line">	        Retrofit retrofit);</span><br><span class="line">	    ...</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExecutorCallAdapterFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CallAdapter</span>.<span class="hljs-title">Factory</span> </span>&#123;</span><br><span class="line">  <span class="hljs-keyword">final</span> Executor callbackExecutor;<span class="hljs-comment">//对应默认的MainThreadExecutor</span></span><br><span class="line"></span><br><span class="line">  ExecutorCallAdapterFactory(Executor callbackExecutor) &#123;</span><br><span class="line">    <span class="hljs-keyword">this</span>.callbackExecutor = callbackExecutor;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="hljs-meta">@Override</span></span><br><span class="line">  <span class="hljs-keyword">public</span> CallAdapter&lt;Call&lt;?&gt;&gt; get(Type returnType, Annotation[] annotations, Retrofit retrofit) &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CallAdapter&lt;Call&lt;?&gt;&gt;() &#123;</span><br><span class="line">      <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">public</span> Type <span class="hljs-title">responseType</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> responseType;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> &lt;R&gt; <span class="hljs-function">Call&lt;R&gt; <span class="hljs-title">adapt</span><span class="hljs-params">(Call&lt;R&gt; call)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ExecutorCallbackCall&lt;&gt;(callbackExecutor, call);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>大家看源码可以发现<code>CallAdapter.Factory</code>工厂是通过<code>get()</code>方法来创建<code>CallAdapter</code>的，所以<code>ExecutorCallAdapterFactory</code>关键代码也是在<code>get()</code>方法的实现上，上面的代码中我们可以看到<code>get()</code>方法返回一个<code>CallAdapter</code>实例，这就是我前面介绍关键类作用时说到的<code>CallAdapter.Factory</code>主要负责生成<code>CallAdapter</code>的实现。</p>
<p>该类中，我们从其类的命名以及代码实现结构上来看，<code>ExecutorCallAdapterFactory</code>其实也使用了一种设计模式，那就是<code>工厂方法模式</code>，其实<code>Retrofit</code>中还有一个地方也使用了<code>工厂方法模式</code>，那就是<code>Converter &amp; Converter.Factory</code>它的实现方式和<code>CallAdapter &amp; CallAdapter.Factory</code>是一样样的。</p>
<h2 id="工厂方式模式-创建CallAdapter-amp-Converter"><a href="#工厂方式模式-创建CallAdapter-amp-Converter" class="headerlink" title="工厂方式模式(创建CallAdapter &amp; Converter)"></a>工厂方式模式(创建CallAdapter &amp; Converter)</h2><p>本文我就已<code>CallAdapter</code>进行举例，看懂<code>CallAdapter</code>的创建原理之后，再看<code>Converter</code>的创建也就比较简单，都是一样的道理。</p>
<h3 id="Retrofit场景-1"><a href="#Retrofit场景-1" class="headerlink" title="Retrofit场景"></a>Retrofit场景</h3><p><code>Retrofit</code>中使用工厂方式模式的场景我在前面讲<code>ExecutorCallAdapterFactory</code>实现的时候已经讲过了，这里就不重复举例了，大家可以对照着源码看下。</p>
<h3 id="工厂方法模式定义"><a href="#工厂方法模式定义" class="headerlink" title="工厂方法模式定义"></a>工厂方法模式定义</h3><p>一个用于创建对象的接口，让子类决定实例化哪个类</p>
<h3 id="工厂方法模式使用场景"><a href="#工厂方法模式使用场景" class="headerlink" title="工厂方法模式使用场景"></a>工厂方法模式使用场景</h3><ol>
<li>不需要知道其具体的类名，只需要知道生成它的工厂</li>
<li>一个类通过其子类来决定创建哪个对象</li>
</ol>
<h3 id="工厂方法模式类图"><a href="#工厂方法模式类图" class="headerlink" title="工厂方法模式类图"></a>工厂方法模式类图</h3><p><img src="/img/design_factory.bmp" alt></p>
<h3 id="Retrofit中的工厂方法"><a href="#Retrofit中的工厂方法" class="headerlink" title="Retrofit中的工厂方法"></a>Retrofit中的工厂方法</h3><ol>
<li><code>Retrofit</code>中使用工厂方法模式可以讲<code>CallAdapter</code>的创建与具体实现充分解耦，对于创建我们只需要知道其工厂即可，不需要关注是如何实现</li>
<li>所以我们可以通过<code>addCallAdapterFactory()</code>和<code>addConverterFactory()</code>很方便的自定义我们自己所需要的适配器工厂和数据转换工厂</li>
<li>通过<code>addCallAdapterFactory()</code>可以很方便的让<code>Retrofit</code>支持<code>RxJava</code>特性，而通过<code>addConverterFactory()</code>可以自定义配置们想要的转换器，让我们可以将请求数据结果转换成我们想要的任意类型。</li>
</ol>
<p>这些就是<code>Retrofit</code>使用工厂方法模式带来的好处。</p>
<h3 id="工厂方法模式优缺点"><a href="#工厂方法模式优缺点" class="headerlink" title="工厂方法模式优缺点"></a>工厂方法模式优缺点</h3><ul>
<li>优点<ol>
<li>只关注产品工厂即可，不需要关注产品如何创建，由工厂确定如何创建</li>
<li>扩展性好，新增产品时，只需要新增一个具体工厂和具体产品</li>
</ol>
</li>
<li>缺点<ol>
<li>新增产品时，需要新增具体工厂和具体产品类，使系统变得庞大</li>
<li>系统中加入抽象层，增加了系统的抽象性和理解难度</li>
</ol>
</li>
</ul>
<h2 id="适配器模式-gt-gt-CallAdapter"><a href="#适配器模式-gt-gt-CallAdapter" class="headerlink" title="适配器模式 &gt;&gt; CallAdapter"></a>适配器模式 &gt;&gt; CallAdapter</h2><h3 id="Retrofit场景-2"><a href="#Retrofit场景-2" class="headerlink" title="Retrofit场景"></a>Retrofit场景</h3><p>先来看看<code>CallAdapter</code>在<code>Retrofit</code>中的使用场景<br><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CallAdapter</span>&lt;<span class="hljs-title">T</span>&gt; </span>&#123;</span><br><span class="line">	<span class="hljs-function"><span class="hljs-keyword">public</span> Type <span class="hljs-title">responseType</span><span class="hljs-params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">public</span> &lt;R&gt; <span class="hljs-function">Call&lt;R&gt; <span class="hljs-title">adapt</span><span class="hljs-params">(Call&lt;R&gt; call)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//ExecutorCallAdapterFactory中生成CallAdapter实例</span></span><br><span class="line"><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CallAdapter&lt;Call&lt;?&gt;&gt;() &#123;</span><br><span class="line">      <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">public</span> Type <span class="hljs-title">responseType</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> responseType;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> &lt;R&gt; <span class="hljs-function">Call&lt;R&gt; <span class="hljs-title">adapt</span><span class="hljs-params">(Call&lt;R&gt; call)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ExecutorCallbackCall&lt;&gt;(callbackExecutor, call);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure></p>
<p>前面讲到<code>ExecutorCallAdapterFactory</code>会生成一个<code>CallAdapter</code>实例。而<code>CallAdapter</code>这个名字看着是不是也很眼熟，也有种似曾相识的感觉，没错，<code>CallAdapter</code>与我们在<code>Android</code>中使用<code>ListView</code>或<code>RecyclerView</code>时经常用到的各种<code>Adapter</code>一样也是一个适配器。</p>
<p>那<code>CallAdapter</code>是来适配什么的呢？</p>
<p>还记得前面介绍关键类的时候说到的<code>OkHttpCall</code>吗？<code>CallAdapter</code>就是来适配<code>OkHttpCall</code>实例的，结合上面的代码来说的话在调用<code>CallAdapter.adapt</code>方法时<code>OkHttpCall</code>实例会作为参数传递给<code>adapt</code>方法从而交给<code>CallAdapter</code>去进行适配。</p>
<p>在我前面举的登录示例中，我们调用<code>login()</code>方法得到的<code>Call</code>实例就是<code>CallAdapter</code>适配<code>OkHttpCall</code>之后得到的一个新<code>Call</code>实例对象，至于为什么是这样，我后面会一一讲解，各位看官不要离开  </p>
<p>所以<code>Retrofit</code>在这个地方又使用了一种设计模式：<code>适配器模式</code></p>
<h3 id="适配器模式定义"><a href="#适配器模式定义" class="headerlink" title="适配器模式定义"></a>适配器模式定义</h3><p>将一个类的接口变成客户端所需要的另一个接口，从而使原本因接口不匹配而无法一起工作的两个类可以在一起工作</p>
<h3 id="适配器模式使用场景"><a href="#适配器模式使用场景" class="headerlink" title="适配器模式使用场景"></a>适配器模式使用场景</h3><ol>
<li>需要复用现有类，而现有类不符合系统需求</li>
<li>需要一个统一的输出接口，而输入端类型不可预知</li>
</ol>
<h3 id="适配器模式类图"><a href="#适配器模式类图" class="headerlink" title="适配器模式类图"></a>适配器模式类图</h3><p><img src="/img/design_adapter.bmp" alt></p>
<h3 id="Retrofit中的适配器模式"><a href="#Retrofit中的适配器模式" class="headerlink" title="Retrofit中的适配器模式"></a>Retrofit中的适配器模式</h3><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//ExecutorCallAdapterFactory中生成CallAdapter实例</span></span><br><span class="line"><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CallAdapter&lt;Call&lt;?&gt;&gt;() &#123;</span><br><span class="line">      <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">public</span> Type <span class="hljs-title">responseType</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> responseType;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> &lt;R&gt; <span class="hljs-function">Call&lt;R&gt; <span class="hljs-title">adapt</span><span class="hljs-params">(Call&lt;R&gt; call)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ExecutorCallbackCall&lt;&gt;(callbackExecutor, call);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>
<p><code>Android</code>平台下默认的<code>CallAdapter</code>会将<code>OkHttpCall</code> 和 <code>MainThreadExecutor</code>两个实例对象适配成一个新的<code>Call</code>实例，这个新的<code>Call</code>实例在执行过程中就具备了切换到UI线程的功能。</p>
<p>那<code>Retrofit</code>在这个地方为什么要使用适配器模式将<code>OkHttpCall</code>进行适配了，直接拿过来用不就可以了吗？</p>
<p>前面讲过<code>OkHttpCall</code>仅仅只是对<code>OkHttp.Call</code>执行网络请求操作的封装，没有其他功能，也就是说<code>OkHttpCall</code>也只有网络请求的功能，而<code>Retrofit</code>是支持多个平台的（安卓，Java8，IOS，甚至包括支持RxJava特性），而不同的平台可能具有不同的特性。</p>
<p>如果在请求过程中需要用到这些特性的话，那么单靠<code>OkHttp.Call</code>是无法完成的，而如果在其他地方柔和进这些特性的支持可能就会使得框架结构不那么严谨平台解耦性比较差，甚至有可能会增加更多的接口。</p>
<p><code>Retrofit</code>通过使用适配器模式将平台特性与<code>OkHttpCall</code>适配成一个最终我们需要的<code>Call</code>实例，这样的话我们在使用过程中只需要关注最后拿到的<code>Call</code>对象，而不需要关注底层这个<code>Call</code>实例到底是什么样的，这也就为我们支持更多的特性提供了可能。比如对RxJava特性的支持，我们只需要提供一个支持<code>RxJava</code>特性的<code>CallAdapter</code>适配器即可，所以我们就可以通过<code>addCallAdapterFactory()</code>配置我们提供的支持<code>RxJava</code>特性的<code>CallAdapter.Factory</code></p>
<h3 id="适配器模式优缺点"><a href="#适配器模式优缺点" class="headerlink" title="适配器模式优缺点"></a>适配器模式优缺点</h3><ul>
<li>优点<ol>
<li>复用性好，引入适配器类来重用适配者类，无需修改原有代码</li>
<li>增加类的透明性，将适配过程封装在适配器类中，对使用者来说相对透明</li>
<li>灵活性扩展性好，通过配置可以随时更换适配器 </li>
</ol>
</li>
<li>缺点<ol>
<li>使用适配器会使系统整体不好把握，调的是A接口，却被适配成了B接口的实现</li>
</ol>
</li>
</ul>
<h2 id="静态代理模式-gt-gt-ExecutorCallbackCall"><a href="#静态代理模式-gt-gt-ExecutorCallbackCall" class="headerlink" title="静态代理模式 &gt;&gt;  ExecutorCallbackCall"></a>静态代理模式 &gt;&gt;  ExecutorCallbackCall</h2><h3 id="Retrofit场景-3"><a href="#Retrofit场景-3" class="headerlink" title="Retrofit场景"></a>Retrofit场景</h3><p>还是先来看看<code>Retrofit</code>中使用<code>ExecutorCallbackCall</code>的场景<br><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//ExecutorCallAdapterFactory中生成CallAdapter实例</span></span><br><span class="line"><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CallAdapter&lt;Call&lt;?&gt;&gt;() &#123;</span><br><span class="line">      ...</span><br><span class="line">      <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> &lt;R&gt; <span class="hljs-function">Call&lt;R&gt; <span class="hljs-title">adapt</span><span class="hljs-params">(Call&lt;R&gt; call)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ExecutorCallbackCall&lt;&gt;(callbackExecutor, call);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure></p>
<p>在上面<code>CallAdapter</code>实现中，可以发现它将<code>OkHttpCall</code>适配成了一个新的<code>Call</code>实例：<code>ExecutorCallbackCall</code>，所以我们接着看看<code>ExecutorCallbackCall</code>的具体实现代码<br><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExecutorCallbackCall</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title">Call</span>&lt;<span class="hljs-title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">final</span> Executor callbackExecutor;<span class="hljs-comment">//Android平台下的Executor：MainThreadExecutor</span></span><br><span class="line">    <span class="hljs-keyword">final</span> Call&lt;T&gt; delegate;<span class="hljs-comment">//网络实际执行者OkHttpCall实例</span></span><br><span class="line"></span><br><span class="line">    ExecutorCallbackCall(Executor callbackExecutor, Call&lt;T&gt; delegate) &#123;</span><br><span class="line">      <span class="hljs-keyword">this</span>.callbackExecutor = callbackExecutor;</span><br><span class="line">      <span class="hljs-keyword">this</span>.delegate = delegate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">enqueue</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Callback&lt;T&gt; callback)</span> </span>&#123;</span><br><span class="line">      <span class="hljs-keyword">if</span> (callback == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException(<span class="hljs-string">"callback == null"</span>);</span><br><span class="line"></span><br><span class="line">      delegate.enqueue(<span class="hljs-keyword">new</span> Callback&lt;T&gt;() &#123;</span><br><span class="line">        <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onResponse</span><span class="hljs-params">(Call&lt;T&gt; call, <span class="hljs-keyword">final</span> Response&lt;T&gt; response)</span> </span>&#123;</span><br><span class="line">          <span class="hljs-comment">//Android平台下此处进行了线程切换</span></span><br><span class="line">          callbackExecutor.execute(<span class="hljs-keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">              <span class="hljs-keyword">if</span> (delegate.isCanceled()) &#123;</span><br><span class="line">                callback.onFailure(ExecutorCallbackCall.<span class="hljs-keyword">this</span>, <span class="hljs-keyword">new</span> IOException(<span class="hljs-string">"Canceled"</span>));</span><br><span class="line">              &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">                callback.onResponse(ExecutorCallbackCall.<span class="hljs-keyword">this</span>, response);</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onFailure</span><span class="hljs-params">(Call&lt;T&gt; call, <span class="hljs-keyword">final</span> Throwable t)</span> </span>&#123;</span><br><span class="line">          <span class="hljs-comment">//Android平台下此处进行了线程切换</span></span><br><span class="line">          callbackExecutor.execute(<span class="hljs-keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">              callback.onFailure(ExecutorCallbackCall.<span class="hljs-keyword">this</span>, t);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isExecuted</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">      <span class="hljs-keyword">return</span> delegate.isExecuted();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">public</span> Response&lt;T&gt; <span class="hljs-title">execute</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;</span><br><span class="line">      <span class="hljs-keyword">return</span> delegate.execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">cancel</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">      delegate.cancel();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isCanceled</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">      <span class="hljs-keyword">return</span> delegate.isCanceled();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@SuppressWarnings</span>(<span class="hljs-string">"CloneDoesntCallSuperClone"</span>) <span class="hljs-comment">// Performing deep clone.</span></span><br><span class="line">    <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">public</span> Call&lt;T&gt; <span class="hljs-title">clone</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ExecutorCallbackCall&lt;&gt;(callbackExecutor, delegate.clone());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">public</span> Request <span class="hljs-title">request</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">      <span class="hljs-keyword">return</span> delegate.request();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>可以看到我们通过<code>login()</code>方法拿到<code>Call</code>实例(也就是<code>ExecutorCallbackCall</code>)之后，在执行网络请求时，在<code>ExecutorCallbackCall</code>的实现中其实都是将具体操作委托给<code>OkHttpCall</code>在执行。所以<code>Retrofit</code>在<code>ExecutorCallbackCall</code>中又使用了一种设计模式：<code>静态代理模式</code></p>
<h3 id="静态代理模式定义"><a href="#静态代理模式定义" class="headerlink" title="静态代理模式定义"></a>静态代理模式定义</h3><p>为其他对象提供一种代理以控制对这个对象的访问</p>
<h3 id="静态代理模式使用场景"><a href="#静态代理模式使用场景" class="headerlink" title="静态代理模式使用场景"></a>静态代理模式使用场景</h3><p>无法访问或不想直接访问某个对象</p>
<h3 id="静态代理模式类图"><a href="#静态代理模式类图" class="headerlink" title="静态代理模式类图"></a>静态代理模式类图</h3><p><img src="/img/design_proxy.bmp" alt></p>
<h3 id="Retrofit中的静态代理"><a href="#Retrofit中的静态代理" class="headerlink" title="Retrofit中的静态代理"></a>Retrofit中的静态代理</h3><p><code>Retrofit</code>中使用<code>ExecutorCallbackCall</code>代理<code>OkHttpCall</code>具体请求操作，可以将<code>Call</code>的使用与底层实现进行解耦，不用关心底层具体请求接口的实现，所以如果将来出现了一个比<code>OkHttp</code>更好的网络请求库，我们完全可以将<code>OkHttp</code>替换掉，即便这样也不会影响外部API接口在项目中的使用。</p>
<h3 id="静态代理的优缺点"><a href="#静态代理的优缺点" class="headerlink" title="静态代理的优缺点"></a>静态代理的优缺点</h3><ul>
<li>优点<ol>
<li>协调调用者与被调用者，降低系统耦合度</li>
<li>减小外部接口与内部接口实现的关联，降低耦合</li>
</ol>
</li>
<li>缺点<ol>
<li>委托对象与代理对象需要实现相同的接口，当接口类增加方法时，除了所有实现类需要增加该方法外，所有代理类也需要实现此方法，增加了维护难度</li>
<li>一个代理类只能代理一种类型的对象</li>
</ol>
</li>
</ul>
<h2 id="动态代理-gt-gt-Retrofit-create"><a href="#动态代理-gt-gt-Retrofit-create" class="headerlink" title="动态代理 &gt;&gt; Retrofit.create()"></a>动态代理 &gt;&gt; Retrofit.create()</h2><p>先看下<code>Retrofit.create()</code>方法的具体实现代码：<br><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-function">T <span class="hljs-title">create</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Class&lt;T&gt; service)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> (T) Proxy.newProxyInstance(service.getClassLoader(), </span><br><span class="line">        <span class="hljs-keyword">new</span> Class&lt;?&gt;[] &#123; service &#125;, <span class="hljs-keyword">new</span> InvocationHandler() &#123;</span><br><span class="line">      <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Platform platform = Platform.get();</span><br><span class="line">      <span class="hljs-meta">@Override</span> </span><br><span class="line">      <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">invoke</span><span class="hljs-params">(Object proxy, Method method, Object... args)</span></span></span><br><span class="line"><span class="hljs-function">          <span class="hljs-keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">        ServiceMethod serviceMethod = loadServiceMethod(method);</span><br><span class="line">        OkHttpCall okHttpCall = <span class="hljs-keyword">new</span> OkHttpCall&lt;&gt;(serviceMethod, args);</span><br><span class="line">        <span class="hljs-keyword">return</span> serviceMethod.callAdapter.adapt(okHttpCall);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>相信很多人在刚开始用<code>Retrofit</code>时都会有一点疑问，我们明明声明的是接口，为什么通过<code>create()</code>方法就能创建出一个对象实例呢？<br>通过上面的实现源码我们找到了答案，那就是使用了JDK中提供的动态代理机制，它会在运行过程中为我们声明的服务接口动态的创建出一个代理对象，以便实现我们的请求操作。我个人认为这是<code>Retrofit</code>框架得以实现的一个核心之处，另外一个核心之处就是其完善的注解机制，关于其注解本文就不说，主要就是一些注解的声明和解析，比较简单，感兴趣的可以去看看。</p>
<p>上面的源码中我们可以看到，运行过程中得到服务接口的代理对象之后，当我们调用<code>login()</code>这样的接口方法时，其实真实执行的是上面源码中写的<code>invoke()</code>方法，所以我们调用<code>login()</code>方法时其实是执行了如下三步：</p>
<ol>
<li>根据反射得到接口方法<code>Method</code>对象生成对应的<code>ServiceMethod</code>对象，该对象会对该声明方法上的所有方法注解、参数注解进行解析以得到一个请求所需要的所有信息</li>
<li>得到<code>ServiceMethod</code>对象之后，会根据该对象和方法调用时传递的参数生成<code>OkHttpCall</code>对象，也就是具体的网络实施者</li>
<li>将<code>OkHttpCall</code>作为<code>CallAdapter</code>适配器中<code>adapt()</code>方法的参数传递给<code>CallAdapter</code>进行适配，最后得到我们所需要的<code>ExecutorCallbackCall</code>对象，也就是调用<code>login()</code>方法得到的<code>Call</code>实例对象</li>
</ol>
<h3 id="动态代理使用场景"><a href="#动态代理使用场景" class="headerlink" title="动态代理使用场景"></a>动态代理使用场景</h3><p>静态代理特点一个代理对应一种类型，如果有多个类需要代理则需要多个代理，而且维护成本高，而动态代理就是来解决此类问题</p>
<h3 id="动态代理特点"><a href="#动态代理特点" class="headerlink" title="动态代理特点"></a>动态代理特点</h3><p>运行期由JVM通过反射机制动态生成，可以代理多种类型，代码复用性高。但是只能代理Java接口，不能代理Java实现类。</p>
<h2 id="Call-enqueue-amp-Call-execute-实现"><a href="#Call-enqueue-amp-Call-execute-实现" class="headerlink" title="Call.enqueue() &amp; Call.execute()实现"></a>Call.enqueue() &amp; Call.execute()实现</h2><p>前面从<code>Retrofit</code>的配置、创建、调用接口方法得到<code>Call</code>实例，基本用法都已经讲的差不多了，现在我们来看基本用法的最后一步<code>Call.enqueue() &amp; Call.execute()</code></p>
<p>前面讲过调用接口方法比如<code>login()</code>时，<code>Android</code>平台下默认得到的是<code>ExecutorCallbackCall</code>实例，而<code>ExecutorCallbackCall</code>实例中执行网络请求的实际上又是<code>OkHttpCall</code>，所以我们来看<code>OkHttpCall</code>中的<code>Call.enqueue() &amp; Call.execute()</code>两个方法的实现，我以<code>Call.enqueue()</code>为例，另外一个大家可以自己去看看</p>
<p>下面是该方法实现的关键代码：</p>
<h3 id="OkHttpCall-enqueue"><a href="#OkHttpCall-enqueue" class="headerlink" title="OkHttpCall.enqueue()"></a>OkHttpCall.enqueue()</h3><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">enqueue</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Callback&lt;T&gt; callback)</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    okhttp3.Call call;</span><br><span class="line">    Throwable failure;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">synchronized</span> (<span class="hljs-keyword">this</span>) &#123;</span><br><span class="line">      <span class="hljs-keyword">if</span> (executed) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalStateException(<span class="hljs-string">"Already executed."</span>);</span><br><span class="line">      executed = <span class="hljs-keyword">true</span>;</span><br><span class="line"></span><br><span class="line">      call = rawCall;</span><br><span class="line">      failure = creationFailure;</span><br><span class="line">      <span class="hljs-keyword">if</span> (call == <span class="hljs-keyword">null</span> &amp;&amp; failure == <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">        <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">	      <span class="hljs-comment">//如果okhttp3.Call为空，则先创建该实例</span></span><br><span class="line">          call = rawCall = createRawCall();</span><br><span class="line">        &#125; <span class="hljs-keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">          failure = creationFailure = t;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">	<span class="hljs-comment">//又讲网络执行转交给okhttp3.Call实例来执行</span></span><br><span class="line">    call.enqueue(<span class="hljs-keyword">new</span> okhttp3.Callback() &#123;</span><br><span class="line">      <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onResponse</span><span class="hljs-params">(okhttp3.Call call, okhttp3.Response rawResponse)</span></span></span><br><span class="line"><span class="hljs-function">          <span class="hljs-keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Response&lt;T&gt; response;</span><br><span class="line">        <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">	      <span class="hljs-comment">//将okhttp3.Response结果包装成Retrofit中的结果对象Response</span></span><br><span class="line">          response = parseResponse(rawResponse);</span><br><span class="line">        &#125; <span class="hljs-keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">          callFailure(e);</span><br><span class="line">          <span class="hljs-keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        callSuccess(response);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onFailure</span><span class="hljs-params">(okhttp3.Call call, IOException e)</span> </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">callFailure</span><span class="hljs-params">(Throwable e)</span> </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">callSuccess</span><span class="hljs-params">(Response&lt;T&gt; response)</span> </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>前面介绍关键类时说过<code>OkHttpCall</code>底层网络执行其实是<code>OkHttp.Call</code>在执行，从上面的代码我们就可以看出来(代码关键地方我加了注释)，上面代码关键第一步是先创建一个<code>okhttp3.call</code>实例，所以我们同样看看创建<code>okhttp3.call</code>实例的代码是怎么实现的<br><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">private</span> okhttp3.<span class="hljs-function">Call <span class="hljs-title">createRawCall</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    Request request = serviceMethod.toRequest(args);</span><br><span class="line">    okhttp3.Call call = serviceMethod.callFactory.newCall(request);</span><br><span class="line">    ...</span><br><span class="line">    <span class="hljs-keyword">return</span> call;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>通过上面的<code>createRawCall()</code>方法实现我们可以发现，它会首先通过<code>ServiceMethod.toRequest()</code>方法生成一个<code>OkHttp.Request</code>对象(这部分代码比较简单，我就不细说了)，然后根据<code>ServiceMethod</code>中的成员变量<code>CallFactory</code>创建一个<code>okhttp3.Call</code>实例。但是这个<code>CallFactory</code>是怎么来的呢？其实我们可以猜到这个<code>CallFactory</code>实例就是<code>OkHttpClient</code>实例。但是我们还是看看<code>ServiceMethod</code>的创建过程</p>
<h3 id="ServiceMethod创建"><a href="#ServiceMethod创建" class="headerlink" title="ServiceMethod创建"></a>ServiceMethod创建</h3><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//在Retrofit.create()方法实现的第一步就是通过loadServiceMethod()方法创建ServiceMethod，这是其实现</span></span><br><span class="line"><span class="hljs-function">ServiceMethod <span class="hljs-title">loadServiceMethod</span><span class="hljs-params">(Method method)</span> </span>&#123;</span><br><span class="line">    ServiceMethod result;</span><br><span class="line">    <span class="hljs-keyword">synchronized</span> (serviceMethodCache) &#123;</span><br><span class="line">      result = serviceMethodCache.get(method);</span><br><span class="line">      <span class="hljs-keyword">if</span> (result == <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">        result = <span class="hljs-keyword">new</span> ServiceMethod.Builder(<span class="hljs-keyword">this</span>, method).build();</span><br><span class="line">        serviceMethodCache.put(method, result);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//下面是ServiceMethod相关关键代码</span></span><br><span class="line"><span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ServiceMethod</span>&lt;<span class="hljs-title">T</span>&gt; </span>&#123;</span><br><span class="line">	<span class="hljs-keyword">final</span> okhttp3.Call.Factory callFactory;</span><br><span class="line">	ServiceMethod(Builder&lt;T&gt; builder) &#123;</span><br><span class="line">	    <span class="hljs-keyword">this</span>.callFactory = builder.retrofit.callFactory();</span><br><span class="line">	    <span class="hljs-keyword">this</span>.callAdapter = builder.callAdapter;</span><br><span class="line">	    <span class="hljs-keyword">this</span>.baseUrl = builder.retrofit.baseUrl();</span><br><span class="line">	    <span class="hljs-keyword">this</span>.responseConverter = builder.responseConverter;</span><br><span class="line">	    ...</span><br><span class="line">	  &#125;</span><br><span class="line">	</span><br><span class="line">	<span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Builder</span> </span>&#123;</span><br><span class="line">		<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Builder</span><span class="hljs-params">(Retrofit retrofit, Method method)</span> </span>&#123;</span><br><span class="line">	      <span class="hljs-keyword">this</span>.retrofit = retrofit;</span><br><span class="line">	      <span class="hljs-keyword">this</span>.method = method;</span><br><span class="line">	      ...</span><br><span class="line">	    &#125;</span><br><span class="line">		<span class="hljs-function"><span class="hljs-keyword">public</span> ServiceMethod <span class="hljs-title">build</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">			  <span class="hljs-comment">//创建CallAdapter</span></span><br><span class="line">		      callAdapter = createCallAdapter();</span><br><span class="line">		      <span class="hljs-comment">//得到请求结果返回类型，接口方法声明</span></span><br><span class="line">		      responseType = callAdapter.responseType();</span><br><span class="line">		      ...</span><br><span class="line">		      <span class="hljs-comment">//创建得到Converter结果转换器</span></span><br><span class="line">		      responseConverter = createResponseConverter();</span><br><span class="line">		      ...</span><br><span class="line">		      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ServiceMethod&lt;&gt;(<span class="hljs-keyword">this</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过上面的<code>ServiceMethod</code>创建过程的相关代码可以看出，<code>ServiceMethod</code>中的实例变量<code>callFactory</code>其实是调用<code>Retrofit.callFactory()</code>方法所得，大家也可以看看上面我注释的<code>CallAdapter</code>和<code>Converter</code>的创建过程，所以我们再来看看这个方法的实现<br><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> okhttp3.Call.<span class="hljs-function">Factory <span class="hljs-title">callFactory</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> callFactory;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>可以看到该方法只是返回了<code>Retrofit</code>中的<code>callFactory</code>实例，同样，我们再来看看<code>Retrofit</code>中的<code>callFactory</code>实例是怎么来的<br><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Retrofit</span> </span>&#123;</span><br><span class="line">	<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> okhttp3.Call.Factory callFactory;</span><br><span class="line">	...</span><br><span class="line">	</span><br><span class="line">	Retrofit(okhttp3.Call.Factory callFactory, ...) &#123;</span><br><span class="line">	    <span class="hljs-keyword">this</span>.callFactory = callFactory;</span><br><span class="line">	    ...</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Builder</span> </span>&#123;</span><br><span class="line">		<span class="hljs-keyword">private</span> okhttp3.Call.Factory callFactory;</span><br><span class="line">		...</span><br><span class="line">		<span class="hljs-function"><span class="hljs-keyword">public</span> Builder <span class="hljs-title">client</span><span class="hljs-params">(OkHttpClient client)</span> </span>&#123;</span><br><span class="line">	      <span class="hljs-keyword">return</span> callFactory(checkNotNull(client, <span class="hljs-string">"client == null"</span>));</span><br><span class="line">	    &#125;</span><br><span class="line">	    </span><br><span class="line">	    <span class="hljs-function"><span class="hljs-keyword">public</span> Builder <span class="hljs-title">callFactory</span><span class="hljs-params">(okhttp3.Call.Factory factory)</span> </span>&#123;</span><br><span class="line">	      <span class="hljs-keyword">this</span>.callFactory = checkNotNull(factory, <span class="hljs-string">"factory == null"</span>);</span><br><span class="line">	      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;</span><br><span class="line">	    &#125;</span><br><span class="line">		</span><br><span class="line">		<span class="hljs-function"><span class="hljs-keyword">public</span> Retrofit <span class="hljs-title">build</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">	      ...</span><br><span class="line">	      okhttp3.Call.Factory callFactory = <span class="hljs-keyword">this</span>.callFactory;</span><br><span class="line">	      <span class="hljs-keyword">if</span> (callFactory == <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">	        callFactory = <span class="hljs-keyword">new</span> OkHttpClient();</span><br><span class="line">	      &#125;</span><br><span class="line">		  ...</span><br><span class="line">	      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Retrofit(callFactory, ...);</span><br><span class="line">	    &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>通过上面的代码，我们可以看出<code>Retrofit</code>中的<code>callFactory</code>实例就是我们使用的<code>OkHttpClient</code>实例，所以这就验证了我们前面猜测的<code>serviceMethod.callFactory</code>就是<code>OkHttpClient</code>实例的猜想。</p>
<p>Ok，回到我们前面将的<code>OkHttpCall.equeue()</code>方法的实现流程上来。</p>
<h3 id="请求结果解析"><a href="#请求结果解析" class="headerlink" title="请求结果解析"></a>请求结果解析</h3><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">call.enqueue(<span class="hljs-keyword">new</span> okhttp3.Callback() &#123;</span><br><span class="line">      <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onResponse</span><span class="hljs-params">(okhttp3.Call call, okhttp3.Response rawResponse)</span></span></span><br><span class="line"><span class="hljs-function">          <span class="hljs-keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Response&lt;T&gt; response;</span><br><span class="line">        <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">	      <span class="hljs-comment">//将okhttp3.Response结果包装成Retrofit中的结果对象Response</span></span><br><span class="line">          response = parseResponse(rawResponse);</span><br><span class="line">        &#125; <span class="hljs-keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">          callFailure(e);</span><br><span class="line">          <span class="hljs-keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        callSuccess(response);</span><br><span class="line">      &#125;</span><br><span class="line">      ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>创建完<code>okhttp3.call</code>实例之后，调用该实现的<code>equeue()</code>方法开始执行网络请求，请求执行完成之后，会调用<code>parseResponse</code>方法，我们来看看这个方法实现的关键代码：<br><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function">Response&lt;T&gt; <span class="hljs-title">parseResponse</span><span class="hljs-params">(okhttp3.Response rawResponse)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    ResponseBody rawBody = rawResponse.body();</span><br><span class="line">	...</span><br><span class="line">	<span class="hljs-comment">//上面省略的这段代码是对请求失败时的结果处理，大家可以自行查看源码</span></span><br><span class="line">	</span><br><span class="line">    ExceptionCatchingRequestBody catchingBody = <span class="hljs-keyword">new</span> ExceptionCatchingRequestBody(rawBody);</span><br><span class="line">    <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">      T body = serviceMethod.toResponse(catchingBody);</span><br><span class="line">      <span class="hljs-keyword">return</span> Response.success(body, rawResponse);</span><br><span class="line">    &#125; <span class="hljs-keyword">catch</span> (RuntimeException e) &#123;</span><br><span class="line">      catchingBody.throwIfCaught();</span><br><span class="line">      <span class="hljs-keyword">throw</span> e;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>这个方法中，当请求成功时，会调用<code>serviceMethod.toResponse()</code>这个方法，我们来看看这个方法又做了哪些事情：<br><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function">T <span class="hljs-title">toResponse</span><span class="hljs-params">(ResponseBody body)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> responseConverter.convert(body);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>很明显，上面方法中就直接调用了<code>ServiceMethod</code>中的<code>Converter</code>实例进行结果转换，也就是说在这个地方<code>Retrofit</code>会帮我们把网络请求结果转换成我们所需要的类型，转换成功之后会调用<code>Response.success(body, rawResponse)</code>将转换后的结果包装成<code>Retrofit</code>中的<code>Response</code>对象。</p>
<h3 id="获取配置的Converter"><a href="#获取配置的Converter" class="headerlink" title="获取配置的Converter"></a>获取配置的Converter</h3><p>问题又来了，上面的<code>Converter</code>是怎么来的呢？</p>
<p>在前面给出的<code>ServiceMethod</code>创建过程的代码块中，我对<code>ServiceMethod</code>中创建<code>Converter</code>实例的代码进行了注释，我们再回过头来看看这段代码：<br><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//ServiceMethod.Buibler中的方法</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> Converter&lt;ResponseBody, T&gt; <span class="hljs-title">createResponseConverter</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">	  ...</span><br><span class="line">      <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> retrofit.responseBodyConverter(responseType, annotations);</span><br><span class="line">      &#125; <span class="hljs-keyword">catch</span> (RuntimeException e) &#123; <span class="hljs-comment">// Wide exception range because factories are user code.</span></span><br><span class="line">        <span class="hljs-keyword">throw</span> methodError(e, <span class="hljs-string">"Unable to create converter for %s"</span>, responseType);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//Retrofit中的方法</span></span><br><span class="line"><span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-function">Converter&lt;ResponseBody, T&gt; <span class="hljs-title">responseBodyConverter</span><span class="hljs-params">(Type type, Annotation[] annotations)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> nextResponseBodyConverter(<span class="hljs-keyword">null</span>, type, annotations);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-function">Converter&lt;ResponseBody, T&gt; <span class="hljs-title">nextResponseBodyConverter</span><span class="hljs-params">(Converter.Factory skipPast,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">      Type type, Annotation[] annotations)</span> </span>&#123;</span><br><span class="line">	...</span><br><span class="line">    <span class="hljs-keyword">int</span> start = converterFactories.indexOf(skipPast) + <span class="hljs-number">1</span>;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = start, count = converterFactories.size(); i &lt; count; i++) &#123;</span><br><span class="line">      Converter&lt;ResponseBody, ?&gt; converter =</span><br><span class="line">          converterFactories.get(i).responseBodyConverter(type, annotations, <span class="hljs-keyword">this</span>);</span><br><span class="line">      <span class="hljs-keyword">if</span> (converter != <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> (Converter&lt;ResponseBody, T&gt;) converter;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(builder.toString());</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>通过上面的代码我们可以看到会从<code>Retrofit</code>的<code>converterFactories</code>转换器工厂集合中去查找当前接口方法对应的转换器工厂。其实这也告诉我们可以在创建<code>Retrofit</code>时配置多个<code>Converter.Factory</code>转换器工厂，也就是说我们一个接口服务中如果声明的多个接口方法的返回值不一样时，我们可以针对性的配置多个不一样的结果转换器工厂去进行结果解析，而不用为了保持结果类型一致对接口进行其他处理。</p>
<p>上面创建<code>ServiceMethod</code>时得到<code>CallAdapter</code>的过程与得到<code>Converter</code>的过程基本一样，我就不赘述了。</p>
<p>到这里，<code>Retrofit</code>的实现原理、实现流程以及其源码实现过程中用到的设计模式就介绍完了。</p>
<p>内容好长，时间好长~~~~</p>
<hr>
<p>原创文章，严禁随意转载，如有问题，欢迎添加个人微信交流。<br><img src="/img/weixinCode.jpeg" width="200" height="200" alt></p>

        </div>
        
        <div class="level is-size-7 is-uppercase">
            <div class="level-start">
                <div class="level-item">
                    <span class="is-size-6 has-text-grey has-mr-7">#</span>
                    <a class="has-link-grey -link" href="/tags/Android/">Android</a>, <a class="has-link-grey -link" href="/tags/Retrofit/">Retrofit</a>
                </div>
            </div>
        </div>
        
        
        
        <div class="bdsharebuttonbox">
    <a href="#" class="bds_more" data-cmd="more"></a>
    <a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a>
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
    <a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a>
    <a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网"></a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
</div>
<script>window._bd_share_config = { "common": { "bdSnsKey": {}, "bdText": "", "bdMini": "2", "bdPic": "", "bdStyle": "0", "bdSize": "16" }, "share": {} }; with (document) 0[(getElementsByTagName('head')[0] || body).appendChild(createElement('script')).src = 'http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion=' + ~(-new Date() / 36e5)];</script>
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3>
        <div class="buttons is-centered">
            
                
<a class="button is-info donate">
    <span class="icon is-small">
        <i class="fab fa-alipay"></i>
    </span>
    <span>支付宝</span>
    <div class="qrcode"><img src="/img/alipay.png" alt="支付宝"></div>
</a>

                
                
<a class="button is-success donate">
    <span class="icon is-small">
        <i class="fab fa-weixin"></i>
    </span>
    <span>微信</span>
    <div class="qrcode"><img src="/img/weixinpay.png" alt="微信"></div>
</a>

                
        </div>
    </div>
</div>



<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        
        <div class="level-start">
            <a class="level level-item has-link-grey  article-nav-prev" href="/RxJava-Basic-Use.html">
                <i class="level-item fas fa-chevron-left"></i>
                <span class="level-item">RxJava学习之基本使用</span>
            </a>
        </div>
        
        
        <div class="level-end">
            <a class="level level-item has-link-grey  article-nav-next" href="/在线视频播放App的实现.html">
                <span class="level-item">在线视频播放App的实现</span>
                <i class="level-item fas fa-chevron-right"></i>
            </a>
        </div>
        
    </div>
</div>


</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered">
                <div>
                    
                        <figure class="image is-128x128 has-mb-6">
                            <img class="is-rounded" src="/images/avatar.png" alt="老胡">
                        </figure>
                    
                    
                    <p class="is-size-4 is-block">
                        老胡
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        Android | Java
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>WuHan, China</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        文章
                    </p>
                    <p class="title has-text-weight-normal">
                        49
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        分类
                    </p>
                    <p class="title has-text-weight-normal">
                        7
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        标签
                    </p>
                    <p class="title has-text-weight-normal">
                        22
                    </p>
                </div>
            </div>
        </nav>
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/huyongli" target="_blank">
                关注我</a>
        </div>
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Github" href="https://github.com/huyongli">
                
                <i class="fab fa-github"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Weibo" href="http://weibo.com/aclaohu">
                
                <i class="fab fa-weibo"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="RSS" href="/atom.xml">
                
                <i class="fas fa-rss"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        
    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                分类
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/Android/">
            <span class="level-start">
                <span class="level-item">Android</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">35</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Blog/">
            <span class="level-start">
                <span class="level-item">Blog</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Java/">
            <span class="level-start">
                <span class="level-item">Java</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/JavaScript/">
            <span class="level-start">
                <span class="level-item">JavaScript</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Linux/">
            <span class="level-start">
                <span class="level-item">Linux</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Material-Design/">
            <span class="level-start">
                <span class="level-item">Material Design</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/小程序/">
            <span class="level-start">
                <span class="level-item">小程序</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
        

<div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            链接
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="https://blog.csdn.net/huyongl1989" target="_blank">
                    <span class="level-left">
                        <span class="level-item">CSDN</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">blog.csdn.net</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="https://juejin.im/user/5cb449ae5188251b0351f391" target="_blank">
                    <span class="level-left">
                        <span class="level-item">掘金</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">juejin.im</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>


    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            标签云
        </h3>
        <a href="/tags/Android/" style="font-size: 20px;">Android</a> <a href="/tags/AndroidStudio/" style="font-size: 10px;">AndroidStudio</a> <a href="/tags/Behavior/" style="font-size: 14px;">Behavior</a> <a href="/tags/DB/" style="font-size: 10px;">DB</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/IM/" style="font-size: 18px;">IM</a> <a href="/tags/JSONP/" style="font-size: 10px;">JSONP</a> <a href="/tags/Java/" style="font-size: 10px;">Java</a> <a href="/tags/JavaScript/" style="font-size: 10px;">JavaScript</a> <a href="/tags/Linux/" style="font-size: 18px;">Linux</a> <a href="/tags/Material-Design/" style="font-size: 14px;">Material Design</a> <a href="/tags/Media/" style="font-size: 10px;">Media</a> <a href="/tags/OkHttp/" style="font-size: 12px;">OkHttp</a> <a href="/tags/RecyclerView/" style="font-size: 16px;">RecyclerView</a> <a href="/tags/Retrofit/" style="font-size: 14px;">Retrofit</a> <a href="/tags/RxJava/" style="font-size: 10px;">RxJava</a> <a href="/tags/Shape/" style="font-size: 10px;">Shape</a> <a href="/tags/SpannableStringBuilder/" style="font-size: 10px;">SpannableStringBuilder</a> <a href="/tags/View/" style="font-size: 12px;">View</a> <a href="/tags/WordPress/" style="font-size: 12px;">WordPress</a> <a href="/tags/小程序/" style="font-size: 14px;">小程序</a> <a href="/tags/百度地图/" style="font-size: 10px;">百度地图</a>
    </div>
</div>

    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
            
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            最新文章
        </h3>
        
        <article class="media">
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2017-07-17T09:50:02.000Z">2017-07-17</time></div>
                    <a href="/weixin-xcx-data-binding-and-params-transfer.html" class="has-link-black-ter is-size-6">微信小程序之页面数据绑定及页面跳转传参</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/小程序/">小程序</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2017-07-17T09:44:58.000Z">2017-07-17</time></div>
                    <a href="/weixin-xcx-tabbar-switch.html" class="has-link-black-ter is-size-6">微信小程序之Tab切换</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/小程序/">小程序</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2017-07-17T09:40:39.000Z">2017-07-17</time></div>
                    <a href="/weixin-xcx-first-project.html" class="has-link-black-ter is-size-6">微信小程序之入门项目</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/小程序/">小程序</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2017-07-12T09:36:51.000Z">2017-07-12</time></div>
                    <a href="/TextSwitcher-ViewSwitcher.html" class="has-link-black-ter is-size-6">TextSwitcher与ViewSwitcher学习笔记</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Android/">Android</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2017-04-30T13:45:04.000Z">2017-04-30</time></div>
                    <a href="/MediaBrowserService.html" class="has-link-black-ter is-size-6">关于媒体浏览器服务(MediaBrowserService)</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Android/">Android</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            归档
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2017/07/">
                <span class="level-start">
                    <span class="level-item">七月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/04/">
                <span class="level-start">
                    <span class="level-item">四月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/03/">
                <span class="level-start">
                    <span class="level-item">三月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/02/">
                <span class="level-start">
                    <span class="level-item">二月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/10/">
                <span class="level-start">
                    <span class="level-item">十月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/09/">
                <span class="level-start">
                    <span class="level-item">九月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/08/">
                <span class="level-start">
                    <span class="level-item">八月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/07/">
                <span class="level-start">
                    <span class="level-item">七月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/06/">
                <span class="level-start">
                    <span class="level-item">六月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/05/">
                <span class="level-start">
                    <span class="level-item">五月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/01/">
                <span class="level-start">
                    <span class="level-item">一月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/10/">
                <span class="level-start">
                    <span class="level-item">十月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">10</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/09/">
                <span class="level-start">
                    <span class="level-item">九月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">9</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/03/">
                <span class="level-start">
                    <span class="level-item">三月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2014/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2014</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                标签
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Android/">
                        <span class="tag">Android</span>
                        <span class="tag is-grey">37</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/AndroidStudio/">
                        <span class="tag">AndroidStudio</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Behavior/">
                        <span class="tag">Behavior</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/DB/">
                        <span class="tag">DB</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Hexo/">
                        <span class="tag">Hexo</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/IM/">
                        <span class="tag">IM</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JSONP/">
                        <span class="tag">JSONP</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Java/">
                        <span class="tag">Java</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JavaScript/">
                        <span class="tag">JavaScript</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Linux/">
                        <span class="tag">Linux</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Material-Design/">
                        <span class="tag">Material Design</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Media/">
                        <span class="tag">Media</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/OkHttp/">
                        <span class="tag">OkHttp</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/RecyclerView/">
                        <span class="tag">RecyclerView</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Retrofit/">
                        <span class="tag">Retrofit</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/RxJava/">
                        <span class="tag">RxJava</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Shape/">
                        <span class="tag">Shape</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SpannableStringBuilder/">
                        <span class="tag">SpannableStringBuilder</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/View/">
                        <span class="tag">View</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/WordPress/">
                        <span class="tag">WordPress</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/小程序/">
                        <span class="tag">小程序</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/百度地图/">
                        <span class="tag">百度地图</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
        
        </div>
    
</div>

                




<div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right ">
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            最新文章
        </h3>
        
        <article class="media">
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2017-07-17T09:50:02.000Z">2017-07-17</time></div>
                    <a href="/weixin-xcx-data-binding-and-params-transfer.html" class="has-link-black-ter is-size-6">微信小程序之页面数据绑定及页面跳转传参</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/小程序/">小程序</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2017-07-17T09:44:58.000Z">2017-07-17</time></div>
                    <a href="/weixin-xcx-tabbar-switch.html" class="has-link-black-ter is-size-6">微信小程序之Tab切换</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/小程序/">小程序</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2017-07-17T09:40:39.000Z">2017-07-17</time></div>
                    <a href="/weixin-xcx-first-project.html" class="has-link-black-ter is-size-6">微信小程序之入门项目</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/小程序/">小程序</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2017-07-12T09:36:51.000Z">2017-07-12</time></div>
                    <a href="/TextSwitcher-ViewSwitcher.html" class="has-link-black-ter is-size-6">TextSwitcher与ViewSwitcher学习笔记</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Android/">Android</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2017-04-30T13:45:04.000Z">2017-04-30</time></div>
                    <a href="/MediaBrowserService.html" class="has-link-black-ter is-size-6">关于媒体浏览器服务(MediaBrowserService)</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Android/">Android</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            归档
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2017/07/">
                <span class="level-start">
                    <span class="level-item">七月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/04/">
                <span class="level-start">
                    <span class="level-item">四月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/03/">
                <span class="level-start">
                    <span class="level-item">三月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/02/">
                <span class="level-start">
                    <span class="level-item">二月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/10/">
                <span class="level-start">
                    <span class="level-item">十月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/09/">
                <span class="level-start">
                    <span class="level-item">九月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/08/">
                <span class="level-start">
                    <span class="level-item">八月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/07/">
                <span class="level-start">
                    <span class="level-item">七月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/06/">
                <span class="level-start">
                    <span class="level-item">六月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/05/">
                <span class="level-start">
                    <span class="level-item">五月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/01/">
                <span class="level-start">
                    <span class="level-item">一月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/10/">
                <span class="level-start">
                    <span class="level-item">十月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">10</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/09/">
                <span class="level-start">
                    <span class="level-item">九月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">9</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/03/">
                <span class="level-start">
                    <span class="level-item">三月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2014/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2014</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                标签
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Android/">
                        <span class="tag">Android</span>
                        <span class="tag is-grey">37</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/AndroidStudio/">
                        <span class="tag">AndroidStudio</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Behavior/">
                        <span class="tag">Behavior</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/DB/">
                        <span class="tag">DB</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Hexo/">
                        <span class="tag">Hexo</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/IM/">
                        <span class="tag">IM</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JSONP/">
                        <span class="tag">JSONP</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Java/">
                        <span class="tag">Java</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JavaScript/">
                        <span class="tag">JavaScript</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Linux/">
                        <span class="tag">Linux</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Material-Design/">
                        <span class="tag">Material Design</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Media/">
                        <span class="tag">Media</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/OkHttp/">
                        <span class="tag">OkHttp</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/RecyclerView/">
                        <span class="tag">RecyclerView</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Retrofit/">
                        <span class="tag">Retrofit</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/RxJava/">
                        <span class="tag">RxJava</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Shape/">
                        <span class="tag">Shape</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SpannableStringBuilder/">
                        <span class="tag">SpannableStringBuilder</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/View/">
                        <span class="tag">View</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/WordPress/">
                        <span class="tag">WordPress</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/小程序/">
                        <span class="tag">小程序</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/百度地图/">
                        <span class="tag">百度地图</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
    
    
</div>

            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/football.svg" alt="透过Retrofit使用看其源码设计模式" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2019 老胡&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a>
                
                <br>
                <span id="busuanzi_container_site_uv">
                共<span id="busuanzi_value_site_uv">0</span>个访客
                </span>
                
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Creative Commons" href="https://creativecommons.org/">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Download on GitHub" href="https://github.com/huyongli">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh-CN");</script>


    
    
    
    <script src="/js/animation.js"></script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
    <script src="/js/gallery.js" defer></script>
    

    
    

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>

    
    

<a id="back-to-top" title="回到顶端" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>


    
    

    
    
    
    

    
    
    
    
    
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>
    <script src="/js/clipboard.js" defer></script>
    

    
    
    

    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="想要查找什么...">
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(无标题)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>